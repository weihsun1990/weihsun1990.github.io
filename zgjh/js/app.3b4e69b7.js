(function(){"use strict";var t={1403:function(t,e,s){var i=s(6369),a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("div",{staticClass:"container"},[t._m(0),e("hr"),e("div",{staticClass:"row"},[e("div",{staticClass:"col"},[t.message?e("div",{staticClass:"alert alert-success alert-dismissible fade show",attrs:{role:"alert"}},[t._v(" "+t._s(t.message)+" "),e("button",{staticClass:"btn-close",attrs:{type:"button"},on:{click:()=>t.message=""}})]):t._e()])]),t.selectFinish?t._e():e("div",{staticClass:"row"},[e("div",{staticClass:"col"},[e("div",{staticClass:"mb-3 text-start"},[e("label",{staticClass:"form-label",attrs:{for:"formFile"}},[t._v("請匯入社團資料")]),e("input",{staticClass:"form-control",attrs:{type:"file"},on:{change:t.importClubCsv}})])])]),t.selectFinish?t._e():e("div",{staticClass:"row"},[e("div",{staticClass:"col"},[e("div",{staticClass:"mb-3 text-start"},[e("label",{staticClass:"form-label",attrs:{for:"formFile"}},[t._v("請匯入學生資料")]),e("input",{staticClass:"form-control",attrs:{type:"file"},on:{change:t.importStudentCsv}})])])]),t.isReadyToSelect&&!t.selectFinish?e("div",{staticClass:"row",staticStyle:{"margin-bottom":"16px"}},[e("div",{staticClass:"col"},[e("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:t.doSelectionProcess}},[t._v(" 開始選社 ")])])]):t._e(),t.selectFinish?e("div",{staticClass:"row",staticStyle:{"margin-bottom":"16px"}},[e("div",{staticClass:"col"},[e("button",{staticClass:"btn btn-primary",staticStyle:{"margin-left":"16px"},attrs:{type:"button"},on:{click:t.resetData}},[t._v(" 重新匯入 ")])])]):t._e(),t.selectFinish?e("table-block",{attrs:{title:"社團抽籤結果",description:`${t.resultClubs?.reduce(((t,e)=>t+e.current),0)}/${t.resultClubs?.reduce(((t,e)=>t+parseInt(e.limit,10)),0)}`,tableItems:t.resultClubs,tableLayout:t.resultClubsLayout}}):t._e(),t.selectFinish?e("table-block",{attrs:{title:"學生選社結果",description:`未中籤人數：${t.resultStudents.filter((t=>!t.club)).length}人`,tableItems:t.resultStudents,tableLayout:t.resultStudentsLayout}}):t._e()],1)])},l=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[e("div",{staticClass:"col"},[e("h4",[t._v("竹光國中選社系統")])])])}],n=(s(7658),{tableKey:"name",classes:(t,e)=>({"table-success":t.current===t.limit}),schema:{index:{title:"#",classes:[],display:(t,e,s)=>e+1},name:{title:"社團名稱",classes:[]},limit:{title:"員額上限",classes:[],display:(t,e,s)=>`${s.current}/${s.limit}`},selection:{title:"入社人員",classes:["text-start"]}}}),r={tableKey:"email",classes:(t,e)=>({"table-danger":!t.club}),schema:{index:{title:"#",classes:[],display:(t,e,s)=>e+1},name:{title:"姓名",classes:[]},email:{title:"mail",classes:[]},club:{title:"中選社團",classes:[],display:t=>t||"未中籤"},order:{title:"中選志願序",classes:[],display:t=>t||""}}},c=function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[e("div",{staticClass:"col"},[e("div",{staticClass:"text-start"},[e("span",[t._v("☞")]),e("span",{staticClass:"t-title link-primary",on:{click:t.clickTitle}},[t._v(" "+t._s(`${t.title} ${t.description}`)+" ")]),e("span",{directives:[{name:"show",rawName:"v-show",value:t.displayTable,expression:"displayTable"}],staticClass:"t-title link-success",on:{click:t.exportCsv}},[t._v(" 匯出 ")])]),e("div",{staticClass:"table-responsive vertical-scroll"},[e("table",{staticClass:"table"},[e("thead",{directives:[{name:"show",rawName:"v-show",value:t.displayTable,expression:"displayTable"}]},[e("tr",t._l(Object.keys(t.tableLayout.schema),(function(s){return e("th",{key:s,class:t.tableLayout.schema[s].classes},[t._v(" "+t._s(t.tableLayout.schema[s].title)+" ")])})),0)]),e("tbody",{directives:[{name:"show",rawName:"v-show",value:t.displayTable,expression:"displayTable"}]},t._l(t.tableItems,(function(s,i){return e("tr",{key:s[t.tableLayout.tableKey],class:t.tableLayout.classes(s,i)},t._l(Object.keys(t.tableLayout.schema),(function(a){return e("td",{key:a,class:t.tableLayout.schema[a].classes},[t._v(" "+t._s(t.tableLayout.schema[a].display?t.tableLayout.schema[a].display(s[a],i,s):s[a])+" ")])})),0)})),0)])])])])},o=[],u={name:"TableBlock",props:{title:{type:String,required:!0},description:{type:String,default:""},tableItems:{type:Array,required:!0},tableLayout:{type:Object,required:!0}},data(){return{displayTable:!0}},methods:{clickTitle(){this.displayTable=!this.displayTable},exportCsv(){const t=[Object.keys(this.tableLayout.schema).map((t=>this.tableLayout.schema[t].title)),...this.tableItems.map(((t,e)=>Object.keys(this.tableLayout.schema).map((s=>this.tableLayout.schema[s].display?this.tableLayout.schema[s].display(t[s],e,t):t[s]))))].map((t=>t.join(","))).join("\r\n"),e=document.createElement("a");document.body.appendChild(e),e.href=URL.createObjectURL(new Blob([t],{type:"application/octet-stream"})),e.download=`${this.title}_${(new Date).getTime()}.csv`,e.click(),e.parentNode.removeChild(e)}}},p=u,d=s(1001),m=(0,d.Z)(p,c,o,!1,null,"3eed3c75",null),h=m.exports,b={name:"App",components:{TableBlock:h},data(){return{message:"",selectFinish:!1,testClubs:[],testStudents:[],resultClubsLayout:n,resultStudentsLayout:r}},methods:{importCsv(t,e){const s=t.target.files[0];s&&".csv"===s.name.match(/\.[0-9a-z]+$/i)[0].toLocaleLowerCase()||(this.testClubs=[],this.message="請匯入csv檔");const i=new FileReader;i.onload=()=>{e(i,t.target)},i.readAsText(s)},importClubCsv(t){this.importCsv(t,((t,e)=>{let s=t.result.split(/\r\n|\n/).reduce(((t,e,s)=>{if(s>=0&&e){const s=e.split(",").map((t=>t.trim()));t.push({key:s[1],name:s[0],limit:s[2],selection:[]})}return t}),[]);this.isDuplicate(s.map((t=>t.key)))&&(s=[],e.value="",this.message="匯入資料包含重複的key值，請檢查後重新匯入"),this.testClubs=s}))},importStudentCsv(t){this.importCsv(t,((t,e)=>{let s=t.result.split(/\r\n|\n/).reduce(((t,e,s)=>{if(s>=0&&e){const s=e.split(",").map((t=>t.trim()));t.push({key:s[1],name:s[0],application:s.slice(2),isDone:!1})}return t}),[]);this.isDuplicate(s.map((t=>t.key)))&&(s=[],e.value="",this.message="匯入資料包含重複的key值，請檢查後重新匯入"),this.testStudents=s}))},doSelectionProcess(){const t=this.testStudents.reduce(((t,e)=>{const s=e.application.length;return t>=s?t:s}),0);let e=0;while(e<=t)this.selectionProcess(++e);this.message="選課完成",this.selectFinish=!0},resetData(){this.selectFinish=!1,this.testClubs=[],this.testStudents=[],document.querySelectorAll('input[type="file"]').forEach((t=>{t.value=""}))},selectionProcess(t){const e=this.testStudents.filter((e=>!e.isDone&&e.application[t-1])).map((e=>({key:e.key,course:e.application[t-1]})));this.testClubs=this.testClubs.map((t=>{if(t.limit>t.selection.length){const s=e.filter((e=>e.course===t.key)).map((t=>t.key)),i=t.limit-t.selection.length,a=this.getMultipleRandom(s,i);t.selection=t.selection.concat(a).sort()}return{...t}})),this.testStudents=this.testStudents.map((e=>{if(!e.isDone){const s=e.application[t-1]||"";e.isDone=s&&this.testClubs.find((t=>t.key===s))?.selection.some((t=>t===e.key))}return{...e}}))},getMultipleRandom(t,e){return[...t].sort((()=>.5-Math.random())).slice(0,e)},isDuplicate(t){return t.some(((e,s)=>t.indexOf(e)!=s))}},computed:{isReadyToSelect(){return this.testClubs.length&&this.testStudents.length},resultClubs(){return this.testClubs.map((t=>{const e=t.selection.map((t=>this.testStudents.find((e=>e.key===t))?.name||t));return{name:t.name,limit:t.limit,current:e.length,selection:e.join("、")}})).sort(((t,e)=>t.current-e.current))},resultStudents(){return this.testStudents.map((t=>{const e=this.testClubs.find((e=>e.selection.some((e=>e===t.key))))?.key;return{name:t.name,email:t.key,club:e,order:t.application.indexOf(e)+1}}))}},watch:{message(t){t&&setTimeout((()=>{this.message=""}),3e3)}}},y=b,v=(0,d.Z)(y,a,l,!1,null,null,null),f=v.exports;i.ZP.config.productionTip=!1,new i.ZP({render:t=>t(f)}).$mount("#app")}},e={};function s(i){var a=e[i];if(void 0!==a)return a.exports;var l=e[i]={exports:{}};return t[i](l,l.exports,s),l.exports}s.m=t,function(){var t=[];s.O=function(e,i,a,l){if(!i){var n=1/0;for(u=0;u<t.length;u++){i=t[u][0],a=t[u][1],l=t[u][2];for(var r=!0,c=0;c<i.length;c++)(!1&l||n>=l)&&Object.keys(s.O).every((function(t){return s.O[t](i[c])}))?i.splice(c--,1):(r=!1,l<n&&(n=l));if(r){t.splice(u--,1);var o=a();void 0!==o&&(e=o)}}return e}l=l||0;for(var u=t.length;u>0&&t[u-1][2]>l;u--)t[u]=t[u-1];t[u]=[i,a,l]}}(),function(){s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,{a:e}),e}}(),function(){s.d=function(t,e){for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};s.O.j=function(e){return 0===t[e]};var e=function(e,i){var a,l,n=i[0],r=i[1],c=i[2],o=0;if(n.some((function(e){return 0!==t[e]}))){for(a in r)s.o(r,a)&&(s.m[a]=r[a]);if(c)var u=c(s)}for(e&&e(i);o<n.length;o++)l=n[o],s.o(t,l)&&t[l]&&t[l][0](),t[l]=0;return s.O(u)},i=self["webpackChunkselection_system"]=self["webpackChunkselection_system"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=s.O(void 0,[998],(function(){return s(1403)}));i=s.O(i)})();
//# sourceMappingURL=app.3b4e69b7.js.map